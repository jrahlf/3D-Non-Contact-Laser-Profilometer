   1              	# 1 "/home/jonas/warwick/3dProfilometer/xpcc/src/xpcc/architecture/platform/cortex_m3/common/delay.
   1              	// coding: utf-8
   1              	...
   0              	
   2              	// ----------------------------------------------------------------------------
   3              	/* Copyright (c) 2011, Roboterclub Aachen e.V.
   4              	 * All rights reserved.
   5              	 *
   6              	 * Redistribution and use in source and binary forms, with or without
   7              	 * modification, are permitted provided that the following conditions are met:
   8              	 *
   9              	 *	 * Redistributions of source code must retain the above copyright
  10              	 *	   notice, this list of conditions and the following disclaimer.
  11              	 *	 * Redistributions in binary form must reproduce the above copyright
  12              	 *	   notice, this list of conditions and the following disclaimer in the
  13              	 *	   documentation and/or other materials provided with the distribution.
  14              	 *	 * Neither the name of the Roboterclub Aachen e.V. nor the
  15              	 *	   names of its contributors may be used to endorse or promote products
  16              	 *	   derived from this software without specific prior written permission.
  17              	 *
  18              	 * THIS SOFTWARE IS PROVIDED BY ROBOTERCLUB AACHEN E.V. ''AS IS'' AND ANY
  19              	 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
  20              	 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  21              	 * DISCLAIMED. IN NO EVENT SHALL ROBOTERCLUB AACHEN E.V. BE LIABLE FOR ANY
  22              	 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  23              	 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  24              	 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  25              	 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  26              	 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  27              	 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  28              	 */
  29              	// ----------------------------------------------------------------------------
  30              	
  31              		.section .fastcode, "x"
  32              		.syntax	unified
  33              		.align	4
  34              		.thumb
  35              		
  36              		// ------------------------------------------------------------------------
  37              		/**
  38              		 * @brief	Simple delay loop (in microseconds resolution)
  39              		 * 
  40              		 * Use Timer-Interrupts etc. for delays whenever possible. This delay-loop
  41              		 * is very inaccurate when interrupts or DMA transfers occur at the same
  42              		 * time. This is because only the number of cycles inside this loop are
  43              		 * counted. External interruptions go unnoticed and will prolong the delay
  44              		 * time.
  45              		 * 
  46              		 * C equivalent:
  47              		 * @code
  48              		 * extern "C" void _delay_us(uint32_t us);
  49              		 * @endcode
  50              		 * 
  51              		 * The function is put into the .fastcode section which resides in RAM to
  52              		 * be sure that it is executed without any waitstates etc. Otherwise
  53              		 * the delay variables had to be adapted every ARM type.
  54              		 * 
  55              		 * An example are the AT91SAM types, which aren't able to run ARM code from
  56              		 * Flash at above 20-30 Mhz without wait-states. Of course this changes
  57              		 * the executing timing which we would like to avoid here to get
  58              		 * at least an reasonably accurate delay. 
  59              		 * 
  60              		 * @see		_delay_ms
  61              		 * @author	Fabian Greif
  62              		 */
  63              		.global	_delay_us
  65              		.thumb_func
  66              		.func	_delay_us
  67              	_delay_us:
  68              		// Example:
  69              		// F_CPU / 1000000 = cycles per us => 72,000,000 / 1,000,000 = 72
  70              		// 72 / 6 cycles per loop = 12
  71 0000 4FF01C01 		mov		r1, #(F_CPU / 1000000 / 6)
  72 0004 4143     		muls	r1, r0, r1
  73              	1:
  74 0006 1CBF     		itt		ne
  75 0008 B1F10101 		subsne	r1, r1, #1
  76 000c FBE7     		bne		1b
  77 000e 7047     		bx		lr
  79              		.endfunc
  80              		
  81              		// ------------------------------------------------------------------------
  82              		/**
  83              		 * @brief	Simple delay loop (in milliseconds resolution)
  84              		 * 
  85              		 * C equivalent:
  86              		 * @code
  87              		 * extern "C" void _delay_ms(uint32_t ms);
  88              		 * @endcode
  89              		 * 
  90              		 * @see		_delay_us
  91              		 * @author	Fabian Greif
  92              		 */
  93              		.global	_delay_ms
  95              		.thumb_func
  96              		.func	_delay_ms
  97              	_delay_ms:
  98              		// see _delay_us
  99 0010 0349     		ldr		r1, =(F_CPU / 1000 / 6)
 100 0012 4143     		muls	r1, r0, r1
 101              	1:
 102 0014 1CBF     		itt		ne
 103 0016 B1F10101 		subsne	r1, r1, #1
 104 001a FBE7     		bne		1b
 105 001c 7047     		bx		lr
 107              		.endfunc
 108              		
 109 001e 0000606D 		.end
 109      0000AFF3 
 109      0080AFF3 
 109      0080AFF3 
 109      0080
DEFINED SYMBOLS
/home/jonas/warwick/3dProfilometer/xpcc/src/xpcc/architecture/platform/cortex_m3/common/delay.sx:33     .fastcode:00000000 $t
/home/jonas/warwick/3dProfilometer/xpcc/src/xpcc/architecture/platform/cortex_m3/common/delay.sx:67     .fastcode:00000000 _delay_us
/home/jonas/warwick/3dProfilometer/xpcc/src/xpcc/architecture/platform/cortex_m3/common/delay.sx:97     .fastcode:00000010 _delay_ms
/home/jonas/warwick/3dProfilometer/xpcc/src/xpcc/architecture/platform/cortex_m3/common/delay.sx:109    .fastcode:0000001e $d
                   .debug_aranges:0000000c $d
/home/jonas/warwick/3dProfilometer/xpcc/src/xpcc/architecture/platform/cortex_m3/common/delay.sx:109    .fastcode:00000024 $t

NO UNDEFINED SYMBOLS
